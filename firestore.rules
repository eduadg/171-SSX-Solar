rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // üîß REGRAS TEMPOR√ÅRIAS PARA DESENVOLVIMENTO
    // ‚ö†Ô∏è IMPORTANTE: Estas regras s√£o para desenvolvimento/teste
    // Em produ√ß√£o, use as regras mais restritivas abaixo
    
    // Permitir leitura e escrita para todos os documentos (apenas para desenvolvimento)
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // üîê REGRAS PARA PRODU√á√ÉO (comentadas por enquanto)
    /*
    // REGRAS PARA USU√ÅRIOS
    match /users/{userId} {
      // Usu√°rios podem ler seus pr√≥prios dados
      allow read: if request.auth != null && request.auth.uid == userId;
      
      // Usu√°rios podem atualizar seus pr√≥prios dados (exceto role)
      allow update: if request.auth != null && 
                   request.auth.uid == userId &&
                   !('role' in resource.data) || 
                   resource.data.role == request.resource.data.role;
      
      // Apenas admins podem criar/deletar usu√°rios e ler todos os usu√°rios
      allow create, delete: if request.auth != null && 
                            get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
      
      // Admins e instaladores podem ler dados de outros usu√°rios (para atribui√ß√µes)
      allow read: if request.auth != null && 
                 (get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin' ||
                  get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'installer');
    }
    
    // REGRAS PARA SOLICITA√á√ïES DE SERVI√áO
    match /serviceRequests/{requestId} {
      // Clientes podem criar solicita√ß√µes
      allow create: if request.auth != null && 
                   request.resource.data.clientId == request.auth.uid;
      
      // Clientes podem ler suas pr√≥prias solicita√ß√µes
      allow read: if request.auth != null && 
                 resource.data.clientId == request.auth.uid;
      
      // Instaladores podem ler solicita√ß√µes atribu√≠das a eles
      allow read: if request.auth != null && 
                 resource.data.installerId == request.auth.uid;
      
      // Instaladores podem atualizar status das suas solicita√ß√µes
      allow update: if request.auth != null && 
                   resource.data.installerId == request.auth.uid &&
                   request.resource.data.clientId == resource.data.clientId;
      
      // Admins podem fazer tudo
      allow read, write: if request.auth != null && 
                        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // REGRAS PARA PRODUTOS
    match /products/{productId} {
      // Todos usu√°rios autenticados podem ler produtos
      allow read: if request.auth != null;
      
      // Apenas admins podem criar/atualizar/deletar produtos
      allow create, update, delete: if request.auth != null && 
                                   get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    */
  }
} 